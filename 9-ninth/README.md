1. consul-playbook.yml выполняется для установки и настройки Consul на назначенных серверах. Этот playbook гарантирует, что будет создан кластер Consul, состоящий как минимум из трех узлов для обеспечения высокой доступности.
2. Развертываются службы, определенные в web-service.yml. настройка серверов для кластера Consul. Playbook гарантирует, что у каждой службы есть конечная точка проверки работоспособности, позволяющая Consul отслеживать работоспособность каждой службы.
3. При включенном Consul запросы DNS разрешаются через DNS-интерфейс Consul, это позволяет выполнять динамическую балансировку DNS, при которой запросы на обслуживание распределяются по исправным экземплярам веб-службы.
4. Consul постоянно отслеживает работоспособность зарегистрированных служб с помощью healthcheck. Если веб-сервер становится неработоспособным, Consul автоматически удаляет его IP-адрес из пула адресов, которые он предоставляет в ответах DNS
5. Когда сбойный экземпляр службы восстанавливается в работоспособном состоянии или добавляются новые экземпляры, они автоматически регистрируются в Consul и включаются в пул балансировки нагрузки
